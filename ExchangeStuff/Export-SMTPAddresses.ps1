Get-Mailbox -ResultSize Unlimited | Select-Object DisplayName,Alias,UserPrincipalName,Name,PrimarySmtpAddress, @{Name="EmailAddresses";Expression={($_.EmailAddresses | Where-Object {$_ -clike "smtp*"} | ForEach-Object {$_ -replace "smtp:",""}) -join ","}} | Sort-Object DisplayName | Export-Csv C:\scripts\user.csv -NoTypeInformation